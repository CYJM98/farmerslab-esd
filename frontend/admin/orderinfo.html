<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>The Farmers Lab</title>



  
  <!--Fontawesome CDN-->
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
  <!--  -->

  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">

  <!-- jQuery library -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

  <!-- Popper JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>

  <!-- Latest compiled JavaScript -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>

  <!-- Custom JavaScript -->
  <script src="../common.js"></script>

  <!--  -->
  <!--Custom styles-->
  <link rel="stylesheet" type="text/css" href="../main.css">

</head>

<body>

  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
    <div class="container">
      <a class="navbar-brand" href="#">The Farmers Lab</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarResponsive">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <div id="field" ></div>
          </li>

          <li class="nav-item active">
            <a class="nav-link" href="adminhome.html">Home
              <span class="sr-only">(current)</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" onclick="logout()">Logout</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Page Content -->
  
  <div class="container">
    <div class="row">
      <div class="col-lg-12" style="margin-top:4%;">
        <b><h4 id="orderid"></h4></b>
        <h6 id="email"></h6>
        <h6 id="tracking"></h6>
        <table class="table table-hover" style="margin-top:4%;">
          <thead>
            <th>Product</th>
            <th>Qty</th>
          </thead>
          <tbody id="orderrow">
          </tbody>
        </table>
      </div> 
    </div>
    <!-- end row -->
    
    <!-- /.row -->

  </div>
  <!-- /.container -->

  <!-- Footer -->
  <footer class="py-5 bg-dark" style="margin-top:2%;">
    <div class="container">
      <p class="m-0 text-center text-white">Copyright &copy; The Farmers Lab 2020</p>
    </div>
    <!-- /.container -->
  </footer>

 
  <script>
    let username = sessionStorage.getItem('username');
    let fname = sessionStorage.getItem('fname');
    let lname = sessionStorage.getItem('lname');
    let order = sessionStorage.getItem('current_order');
    console.log(order);

    if( lname!=null && fname!=null & username!=null){ //to check if user is logged in
        $("div#field").html(fname + " " + lname+","); 
        if(order == null){
            window.location.href = "adminhome.html";
        }else{
        
            $(async () => {     
            var orderURL = "http://127.0.0.1:5002/order/" + order;
                    try {
                        const response =
                            await fetch(
                                orderURL, { method: 'GET' }
                            );

                        const data = await response.json();

                            if (response.ok) {
                                
                                var dataArr = data.orders;
                                //console.log(dataArr);
                                var orderid = "";
                                var email = "";
                                var products = [];
                                for (var i = 0; i < dataArr.length; i++){
                                    orderid = dataArr[i]["OrderID"];
                                    email = dataArr[i]["CustEmail"];
                                    var productname = dataArr[i]["ProductName"]
                                    var qty = dataArr[i]["OrderQuantity"]
                                    products[productname] = qty
                                }           
                                console.log(products);
                            } 

                            $("#orderid").append("Order ID - " + orderid);
                            $("#email").append("<b>Customer:</b> " + email);
                            $("#tracking").append("<b>Tracking ID:</b> " + "-");
                            for(var item in products){
                                var value = products[item];
                                var row = "<tr><td>" + item + "</td><td>" +
                                              value + "</td></tr>";
                                $("#orderrow").append(row);
                            }

                    } catch (error) {
                        // Errors when calling the service; such as network error, 
                        // service offline, etc
                        console.log('There is a problem retrieving order data, please try again later.<br />' + error);
                        $('div.col-lg-9').append('There is a problem retrieving order data, please try again later.<br />' + error); 

                    }    
                
            });
        }
    }else{
      window.location.href = "index.html";
    }
</script>

</body>

</html>
